<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trip Tracker - Stats</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
  <header class="bg-emerald-600 text-white p-4 shadow-lg">
    <h1 class="text-2xl font-bold text-center"><i class="fas fa-chart-line mr-2"></i>Stats</h1>
    <p class="text-center text-emerald-100 mt-1">Recent Pickups</p>
  </header>

  <div class="container mx-auto px-4 py-6 max-w-3xl">
    <div class="bg-white rounded-lg shadow-md p-4 mb-4 flex flex-col md:flex-row gap-3">
      <input id="date" type="date" class="border p-2 rounded w-full md:w-1/3" />
      <input id="unit" type="text" placeholder="Unit (optional)" class="border p-2 rounded w-full md:w-1/3" />
      <input id="route" type="text" placeholder="Route (optional)" class="border p-2 rounded w-full md:w-1/3" />
      <button id="refresh" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded">Refresh</button>
    </div>

    <div id="summary" class="mb-3 text-gray-700"></div>

    <div class="bg-white rounded-lg shadow-md overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="text-left p-2 border-b">Time</th>
            <th class="text-left p-2 border-b">Unit</th>
            <th class="text-left p-2 border-b">Route</th>
            <th class="text-left p-2 border-b">#</th>
            <th class="text-left p-2 border-b">Lat</th>
            <th class="text-left p-2 border-b">Lng</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>

  <script>
    const rows = document.getElementById('rows');
    const date = document.getElementById('date');
    const unit = document.getElementById('unit');
    const route = document.getElementById('route');
    const refreshBtn = document.getElementById('refresh');
    const summary = document.getElementById('summary');

    date.value = new Date().toISOString().split('T')[0];

    async function load() {
      const params = new URLSearchParams();
      params.set('limit', '200');
      if (date.value) params.set('date', date.value);
      if (unit.value) params.set('unit', unit.value);
      if (route.value) params.set('route', route.value);
      const res = await fetch(`/api/pickups?${params.toString()}`);
      const data = await res.json();
      rows.innerHTML = '';
      let total = 0;
      for (const d of data.items) {
        total += 1;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2 border-b">${new Date(d.time).toLocaleString()}</td>
          <td class="p-2 border-b">${d.unit}</td>
          <td class="p-2 border-b">${d.route}</td>
          <td class="p-2 border-b">${d.passengerNumber}</td>
          <td class="p-2 border-b">${d.location?.lat?.toFixed?.(6) ?? ''}</td>
          <td class="p-2 border-b">${d.location?.lng?.toFixed?.(6) ?? ''}</td>
        `;
        rows.appendChild(tr);
      }
      summary.textContent = `Showing ${data.count} pickups. Total rows: ${total}.`;
    }

    refreshBtn.addEventListener('click', load);
    load();
  </script>
</body>
</html>


